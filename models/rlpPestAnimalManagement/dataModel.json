{
    "dataModel": [
        {
            "columns": [
                {
                    "dataType": "text",
                    "name": "initialOrFollowup",
                    "constraints": [
                        "Initial",
                        "Follow-up"
                    ],
                    "validate": "required"
                },
                {
                    "dataType": "feature",
                    "name": "site"
                },
                {
                    "dataType": "number",
                    "name": "siteCalculatedAreaHa",
                    "computed": {
                        "expression": "$geom.areaHa(sitesInstalled)"
                    },
                    "units": "ha"
                },
                {
                    "dataType": "number",
                    "name": "siteCalculatedLengthKm",
                    "computed": {
                        "expression": "$geom.lengthKm(sitesInstalled)"
                    },
                    "units": "km"
                },
                {
                    "dataType": "number",
                    "name": "areaControlledHa",
                    "validate": "required,min[0]",
                    "units": "ha"
                },
                {
                    "dataType": "number",
                    "name": "lengthControlledKm",
                    "validate": "required,min[0]",
                    "units": "km"
                },
                {
                    "dataType": "number",
                    "name": "areaInvoicedHa",
                    "defaultValue": {
                        "type": "computed",
                        "expression": "$geom.areaHa(sitesInstalled)"
                    },
                    "units": "ha",
                    "validate": [
                        {
                            "rule": "max",
                            "param": {
                                "type": "computed",
                                "expression": "areaInstalledHa"
                            }
                        }
                    ]
                },
                {
                    "dataType": "number",
                    "name": "lengthInvoicedKm",
                    "defaultValue": {
                        "type": "computed",
                        "expression": "$geom.lengthKm(sitesInstalled)"
                    },
                    "units": "km",
                    "validate": [
                        {
                            "rule": "max",
                            "param": {
                                "type": "computed",
                                "expression": "lengthInstalledKm"
                            }
                        }
                    ]
                },
                {
                    "dataType": "stringList",
                    "name": "mappingNotAlignedReasons",
                    "constraints": [
                        "Work was undertaken over a greater area will be invoiced for",
                        "Mapped area simplifies more complex area/s where work was undertaken during this period",
                        "Other"
                    ],
                    "validate": "required",
                    "behaviour": [
                        {
                            "condition": "areaInstalledHa > areaInvoicedHa or lengthInstalledKm > lengthInvoicedKm",
                            "type": "enable"
                        }
                    ]
                },
                {
                    "dataType": "text",
                    "name": "mappingNotAlignedComments",
                    "behaviour": [
                        {
                            "type": "enable",
                            "condition": "\"Other\" in mappingNotAlignedReasons"
                        }]
                },
                {
                    "dataType": "document",
                    "name": "maps"
                },
                {
                    "columns": [
                        {
                            "dataType": "species",
                            "name": "pestSpecies",
                            "dwcAttribute": "scientificName",
                            "description": "Pest species targeted for treatment (start typing a  scientific or common name for a species)",
                            "validate": "required"
                        },
                        {
                            "dataType": "text",
                            "name": "pestManagementMethod",
                            "dwcAttribute": "treatmentMethod",
                            "description": "The method used in this activity to manage pests",
                            "constraints": [
                                "Aerial shoot",
                                "Bait & trap",
                                "Bait only",
                                "Feral free enclosure",
                                "Exclusion fencing",
                                "Fumigation",
                                "Ground shoot",
                                "Trap & cull",
                                "Trap & remove",
                                "Other"
                            ],
                            "validate": "required"
                        },
                        {
                            "dataType": "text",
                            "name": "otherManagementMethod",
                            "description": "Please specify the management method used if Other was selected in the Management Method column.",
                            "behaviour": [{
                                "condition": "pestManagementMethod == \"Other\"",
                                "type": "enable"
                            }],
                            "validate": "required,maxSize[100]"
                        },
                        {
                            "dataType": "text",
                            "name": "treatmentObjective",
                            "validate": "required,maxSize[300]"
                        },
                        {
                            "dataType": "text",
                            "name": "individualsOrColonies",
                            "constraints": [
                                "Colonies",
                                "Individuals"
                            ],
                            "validate": "required"
                        },
                        {
                            "dataType": "number",
                            "name": "individualsOrColoniesRemoved",
                            "validate": "required"
                        }
                    ],
                    "dataType": "list",
                    "name": "pestAnimalsControlled"
                }
            ],
            "dataType": "list",
            "name": "areasControlled"
        },
        {
            "dataType": "image",
            "name": "photographicEvidence"
        }
    ],
    "modelName": "RLP - Pest animal management",
    "title": "Controlling pest animals",
    "viewModel": [{
        "type": "section",
        "items": [
            {
                "addRowText": "Add a new controlled area",
                "userAddedRows": true,
                "source": "areasControlled",
                "type": "repeat",
                "items": [
                    {
                        "type": "row",
                        "items": [
                            {
                                "preLabel": "Initial or follow-up control?",
                                "css": "span3",
                                "source": "initialOrFollowup",
                                "type": "selectOne"
                            }
                        ]
                    },
                    {
                        "type": "row",
                        "items": [
                            {
                                "preLabel": "Site/s where pest control was undertaken",
                                "source": "site",
                                "type": "feature"
                            },
                            {
                                "css": "span2",
                                "preLabel": "Calculated area",
                                "source": "siteCalculatedAreaHa",
                                "type": "number",
                                "readonly": true,
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            },
                            {
                                "css": "span2",
                                "preLabel": "Calculated length",
                                "source": "siteCalculatedLengthKm",
                                "type": "number",
                                "readonly": true,
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            }
                        ]
                    },
                    {
                        "type": "row",
                        "items": [
                            {
                                "preLabel": "Area (ha) treated for pest animals",
                                "css": "span2",
                                "source": "areaControlledHa",
                                "type": "number",
                                "validate": "required",
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            },
                            {
                                "preLabel": "Length (km) treated for pest animals",
                                "css": "span2",
                                "source": "lengthControlledKm",
                                "type": "number",
                                "validate": "required",
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            }
                        ]
                    },
                    {
                        "type": "row",
                        "items": [
                            {
                                "preLabel": "Area invoiced",
                                "css": "span2",
                                "source": "areaInvoicedHa",
                                "type": "number",
                                "validate": "required",
                                "displayOptions": {
                                    "displayUnits": true
                                }

                            },
                            {
                                "preLabel": "Length invoiced",
                                "css": "span2",
                                "source": "lengthInvoicedKm",
                                "validate": "required",
                                "type": "number",
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            }
                        ]
                    },
                    {
                        "type": "row",
                        "items": [
                            {
                                "preLabel": "Please enter the reason/s the mapping didn't align with the invoiced amount",
                                "source": "mappingNotAlignedReasons",
                                "type": "selectMany"
                            },
                            {
                                "preLabel": "Please enter the reason/s the mapping didn't align with the invoiced amount",
                                "source": "mappingNotAlignedComments",
                                "type": "textarea",
                                "rows": 5
                            },
                            {
                                "preLabel": "Please attach mapping details",
                                "source": "maps",
                                "type": "document"
                            }
                        ]
                    },
                    {
                        "type": "row",
                        "items": [{
                            "addRowText": "Add a species",
                            "columns": [
                                {
                                    "width": "40%",
                                    "source": "pestSpecies",
                                    "title": "Target pest species",
                                    "type": "speciesSelect"
                                },
                                {
                                    "width": "10%",
                                    "source": "pestManagementMethod",
                                    "title": "Type of control",
                                    "type": "selectOne"
                                },
                                {
                                    "width": "10%",
                                    "source": "otherManagementMethod",
                                    "title": "Type of control (if other)",
                                    "type": "text"
                                },
                                {
                                    "width": "20%",
                                    "source": "treatmentObjective",
                                    "title": "Treatment objective",
                                    "type": "textarea"
                                },
                                {
                                    "width": "10%",
                                    "source": "individualsOrColonies",
                                    "title": "Individuals or colonies?",
                                    "type": "selectOne"
                                },
                                {
                                    "width": "10%",
                                    "source": "individualsOrColoniesRemoved",
                                    "title": "Number of individuals or colonies removed / destroyed",
                                    "type": "number"
                                }
                            ],
                            "userAddedRows": true,
                            "source": "pestAnimalsControlled",
                            "type": "table"
                        }]
                    }
                ]
            },
            {
                "type": "row",
                "items": [{
                    "preLabel": "Optionally attach photos",
                    "source": "photographicEvidence",
                    "type": "image"
                }]
            }
        ]
    }]
}