{
    "dataModel": [
        {
            "columns": [
                {
                    "dataType": "number",
                    "name": "numberInstalled",
                    "validate": "required,min[0]"
                },
                {
                    "dataType": "feature",
                    "name": "sitesInstalled"
                },
                {
                    "dataType": "number",
                    "name": "sitesInstalledCalculatedAreaHa",
                    "computed": {
                        "expression": "$geom.areaHa(sitesInstalled)"
                    },
                    "units": "ha"
                },
                {
                    "dataType": "number",
                    "name": "sitesInstalledCalculatedLengthKm",
                    "computed": {
                        "expression": "$geom.lengthKm(sitesInstalled)"
                    },
                    "units": "km"
                },

                {
                    "dataType": "number",
                    "name": "areaInstalledHa",
                    "units": "ha"
                },
                {
                    "dataType": "number",
                    "name": "lengthInstalledKm",
                    "units": "km"
                },
                {
                    "dataType": "number",
                    "name": "areaInvoicedHa",
                    "defaultValue": {
                        "type": "computed",
                        "expression": "$geom.areaHa(sitesInstalled)"
                    },
                    "units": "ha",
                    "validate": [
                        {
                            "rule": "max",
                            "param": {
                                "type": "computed",
                                "expression": "areaInstalledHa"
                            }
                        }
                    ]
                },
                {
                    "dataType": "number",
                    "name": "lengthInvoicedKm",
                    "defaultValue": {
                        "type": "computed",
                        "expression": "$geom.lengthKm(sitesInstalled)"
                    },
                    "units": "km",
                    "validate": [
                        {
                            "rule": "max",
                            "param": {
                                "type": "computed",
                                "expression": "lengthInstalledKm"
                            }
                        }
                    ]
                },
                {
                    "dataType": "stringList",
                    "name": "mappingNotAlignedReasons",
                    "constraints": [
                        "Work was undertaken over a greater area will be invoiced for",
                        "Mapped area simplifies more complex area/s where work was undertaken during this period",
                        "Other"
                    ],
                    "validate": "required",
                    "behaviour": [
                        {
                            "condition": "areaInstalledHa > areaInvoicedHa or lengthInstalledKm > lengthInvoicedKm",
                            "type": "enable"
                        }
                    ]
                },
                {
                    "dataType": "text",
                    "name": "mappingNotAlignedComments",
                    "behaviour": [
                        {
                            "type": "enable",
                            "condition": "\"Other\" in mappingNotAlignedReasons"
                        }]
                },
                {
                    "dataType": "document",
                    "name": "maps"
                },
                {
                    "dataType": "feature",
                    "name": "protectedSites"
                },
                {
                    "defaultValue": {
                        "type": "computed",
                        "expression": "$geom.areaHa(protectedSites)"
                    },
                    "dataType": "number",
                    "name": "areaProtectedHa",
                    "units": "ha",
                    "validate": [
                        {
                            "rule": "min",
                            "param": {
                                "type": "computed",
                                "expression": "$geom.areaHa(protectedSites)*0.9"
                            }
                        },
                        {
                            "rule": "max",
                            "param": {
                                "type": "computed",
                                "expression": "$geom.areaHa(protectedSites)*1.1"
                            }
                        }
                    ]
                },
                {
                    "dataType": "text",
                    "name": "accessControlType",
                    "description": "",
                    "constraints": [
                        "Boardwalks",
                        "Bollards & barriers",
                        "Constructed parking bays",
                        "Fencing, styles, gates & grids",
                        "Formed traffic ways",
                        "Signage",
                        "Other"
                    ],
                    "validate": "required"
                },
                {
                    "dataType": "text",
                    "name": "otherAccessControlType",
                    "description": "Please specify the type of access control if Other (specify in notes) was selected in the Type of Access Control Installed column.",
                    "behaviour": [{
                        "condition": "accessControlType == \"Other\"",
                        "type": "enable"
                    }],
                    "validate": "required"
                },
                {
                    "dataType": "text",
                    "name": "controlObjective",
                    "description": "What is your access control method? and/or What do you intend to achieve by using your structure/s?",
                    "validate": "required,maxSize[300]"
                }
            ],
            "dataType": "list",
            "name": "accessControlDetails"
        },
        {
            "dataType": "image",
            "name": "photographicEvidence"
        }
    ],
    "modelName": "RLP - Controlling access",
    "title": "Controlling access",
    "viewModel": [{
        "type": "section",
        "items": [
            {
                "columns": [
                    {
                        "width": "8%",
                        "source": "numberInstalled",
                        "type": "number",
                        "title": "Number of structures installed"
                    },
                    {
                        "width": "8%",
                        "type": "col",
                        "title": "Site/s where access has been controlled",
                        "items": [
                            {
                                "type": "feature",
                                "source": "sitesInstalled"
                            },
                            {
                                "type": "number",
                                "source": "sitesInstalledCalculatedAreaHa",
                                "readonly": true,
                                "width": "5%",
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            },
                            {
                                "type": "number",
                                "source": "sitesInstalledCalculatedLengthKm",
                                "readonly": true,
                                "width": "5%",
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            }
                        ]
                    },
                    {
                        "width": "8%",
                        "type": "col",
                        "title": "Actual length (km) / area (ha) where access has been controlled",
                        "helpText": "May be changed manually if different to the calculated areas",
                        "items": [
                            {
                                "type": "number",
                                "source": "areaInstalledHa",
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            },
                            {
                                "type": "number",
                                "source": "lengthInstalledKm",
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            }
                        ]
                    },
                    {
                        "width": "8%",
                        "type": "col",
                        "title": "Area (ha) / Length (km) invoiced",
                        "helpText": "May be changed manually if different to the calculated areas",
                        "items": [
                            {
                                "type": "number",
                                "source": "areaInvoicedHa",
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            },
                            {
                                "type": "number",
                                "source": "lengthInvoicedKm",
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            }
                        ]
                    },
                    {
                        "title": "Please enter the reason/s the mapping didn't align with the invoiced amount",
                        "source": "mappingNotAlignedReasons",
                        "type": "selectMany",
                        "width": "17%"
                    },
                    {
                        "title": "Please enter the reason/s the mapping didn't align with the invoiced amount",
                        "source": "mappingNotAlignedComments",
                        "type": "textarea",
                        "rows": 5,
                        "width": "16%"
                    },
                    {
                        "title": "Please attach mapping details",
                        "source": "maps",
                        "type": "document"
                    },
                    {
                        "width": "6%",

                        "type": "col",
                        "title": "Site/s protected by access control structures",
                        "items": [
                            {
                                "source": "protectedSites",
                                "type": "feature"
                            },
                            {
                                "source": "areaProtectedHa",
                                "type": "number",
                                "displayOptions": {
                                    "displayUnits": true
                                }
                            }
                        ]

                    },
                    {
                        "type": "col",
                        "items": [
                            {
                                "source": "accessControlType",
                                "type": "select2"
                            },
                            {
                                "source": "otherAccessControlType",
                                "type": "text"
                            }
                        ],
                        "title": "Type of access control installed",
                        "width": "10%"

                    },
                    {
                        "width": "16%",
                        "source": "controlObjective",
                        "title": "Control objective",
                        "type": "textarea",
                        "rows": 5
                    }
                ],
                "userAddedRows": true,
                "source": "accessControlDetails",
                "type": "table"
            },
            {
                "type": "row",
                "items": [{
                    "preLabel": "Optionally attach photos of the access control work performed",
                    "source": "photographicEvidence",
                    "type": "image"
                }]
            }
        ]
    }]
}