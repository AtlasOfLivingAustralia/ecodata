{
    "dataModel": [{
        "columns": [
            {
                "dataType": "text",
                "name": "agreementType",
                "description": "",
                "constraints": [
                    "On title in perpetuity (e.g. conservation convenant)",
                    "Binding agreement not on title in perpetuity (e.g. property vegetation plan)",
                    "Termed agreement not on title - binding (e.g. land management agreement)",
                    "Not on title - non-binding (e.g. Wildlife Refuge)",
                    "No protection mechanism applicable",
                    "Other"
                ],
                "validate": "required"
            },
            {
                "dataType": "text",
                "name": "otherAgreementType",
                "description": "",
                "behaviour": [{
                    "condition": "agreementType == \"Other\"",
                    "type": "enable"
                }],
                "validate": "required,maxSize[300]"
            },
            {
                "dataType": "text",
                "name": "establishedOrMaintained",
                "constraints": [
                    "Established",
                    "Maintained"
                ],
                "validate": "required"
            },
            {
                "dataType": "number",
                "name": "numberOfAgreements",
                "validate": "required,min[0]"
            },
            {
                "dataType": "number",
                "name": "numberOfDaysMaintainingAgreements",
                "description": "Number of days should be calculated as number of days by number of people (eg. 4.5 days by 3 people is 13.5 days)",
                "validate": "required,min[0]"
            },
            {
                "dataType": "feature",
                "name": "agreementSites"
            },
            {
                "defaultValue": {
                    "type": "computed",
                    "expression": "$geom.areaHa(agreementSites)"
                },
                "dataType": "number",
                "name": "areaCoveredByAgreementsHa",
                "units": "ha",
                "validate": [
                    {
                        "rule": "min",
                        "param": {
                            "type": "computed",
                            "expression": "$geom.areaHa(agreementSites)*0.9"
                        }
                    },
                    {
                        "rule": "max",
                        "param": {
                            "type": "computed",
                            "expression": "$geom.areaHa(agreementSites)*1.1"
                        }
                    }
                ]
            },
            {
                "defaultValue": {
                    "type": "computed",
                    "expression": "areaCoveredByAgreementsHa"
                },
                "dataType": "number",
                "units": "ha",
                "name": "actualAreaCoveredByAgreementsHa",
                "validate": [
                    {"rule": "min[0]"},
                    {
                        "rule": "max",
                        "param": {
                            "type": "computed",
                            "expression": "areaCoveredByAgreementsHa"
                        }
                    }
                ]
            },
            {
                "dataType": "text",
                "name": "mappingNotAlignedReason",
                "constraints": [
                    "Mapped area simplifies more complex area/s where work was undertaken during this period",
                    "Other"
                ],
                "validate": "required",
                "behaviour": [
                    {
                        "condition": "not (within(actualAreaCoveredByAgreementsHa, areaCoveredByAgreementsHa, 0.1))",
                        "type": "visible"
                    }
                ]
            },
            {
                "dataType": "text",
                "name": "mappingNotAlignedComments",
                "validate": "required,maxSize[300]",
                "behaviour": [
                    {
                        "type": "visible",
                        "condition": "\"Other\" == mappingNotAlignedReason"
                    }]
            },


            {
                "dataType": "number",
                "units": "ha",
                "name": "areaOfCoveredByAgreementsInvoicedHa",
                "validate": [
                    {"rule": "min[0]"},
                    {
                        "rule": "max",
                        "param": {
                            "type": "computed",
                            "expression": "actualAreaCoveredByAgreementsHa"
                        }
                    }
                ]
            },
            {
                "dataType": "document",
                "name": "extraMappingDetails",
                "validate": "required",
                "description": "This field needs to be filled when figures for Mapped/Actual/Invoice amounts differ. Please attach a map of the area that was covered by this project service during reporting period (include the scale measure for each map)",
                "behaviour": [
                    {
                        "condition": "not (within(areaCoveredByAgreementsHa, actualAreaCoveredByAgreementsHa, 0.1)) or roundTo(actualAreaCoveredByAgreementsHa, 2) != roundTo(areaOfCoveredByAgreementsInvoicedHa, 2)",
                        "type": "visible"
                    }
                ]
            },

            {
                "dataType": "text",
                "name": "invoicedNotActualReason",
                "constraints": [
                    "Work was undertaken over a greater area than will be invoiced for",
                    "Other"
                ],
                "validate": "required",
                "behaviour": [
                    {
                        "condition": "roundTo(areaOfCoveredByAgreementsInvoicedHa, 2) != roundTo(actualAreaCoveredByAgreementsHa, 2)",
                        "type": "visible"
                    }
                ]
            },
            {
                "dataType": "text",
                "name": "invoicedNotActualComments",
                "behaviour": [
                    {
                        "type": "visible",
                        "condition": "\"Other\" == invoicedNotActualReason"
                    }],
                "validate": "required,maxSize[300]"
            }


        ],
        "dataType": "list",
        "name": "agreements"
    }],
    "modelName": "RLP - Establishing Agreements",
    "title": "Establishing and maintaining agreements",
    "viewModel": [{
        "type": "section",
        "items": [{
            "columns": [
                {
                    "width": "20%",
                    "title": "Agreement type",
                    "type": "col",
                    "items": [
                        {
                            "source": "agreementType",
                            "type": "select2"
                        },
                        {
                            "source": "otherAgreementType",
                            "type": "textarea"
                        }
                    ]
                },

                {
                    "width": "10%",
                    "source": "establishedOrMaintained",
                    "type": "selectOne",
                    "title": "Established or maintained?"
                },
                {
                    "width": "10%",
                    "source": "numberOfAgreements",
                    "type": "number",
                    "title": "Number of agreements"
                },
                {
                    "width": "10%",
                    "source": "numberOfDaysMaintainingAgreements",
                    "type": "number",
                    "title": "Number of days maintaining agreements (if applicable)"
                },
                {
                    "width": "20%",
                    "title": "Site/s where agreements were established",
                    "type": "col",
                    "items": [
                        {
                            "source": "agreementSites",
                            "type": "feature"
                        },
                        {
                            "source": "areaCoveredByAgreementsHa",
                            "type": "number",
                            "readonly": "readonly",
                            "displayOptions": {
                                "displayUnits": true
                            }
                        },
                        {
                            "type": "row",
                            "items": [
                                {
                                    "preLabel": "Please attach mapping details",
                                    "source": "extraMappingDetails",
                                    "type": "document"
                                }
                            ]
                        }
                    ]

                 },
                {
                    "width": "15%",
                    "type": "col",
                    "title": "Actual area (ha) of site/s agreements",
                    "helpText": "Enter the actual amount during this reporting period.",
                    "items": [
                        {
                            "source": "actualAreaCoveredByAgreementsHa",
                            "type": "number",
                            "displayOptions": {
                                "displayUnits": true
                            }
                        },

                        {
                            "type": "row",
                            "items": [
                                {
                                    "preLabel": "Reason for actual amount being different to aligned amount",
                                    "source": "mappingNotAlignedReason",
                                    "type": "selectOne"

                                }
                            ]
                        },
                        {
                            "type": "row",
                            "items": [
                                {
                                    "placeholder": "Please enter the reason/s the actual didn't align with the agreed amount",
                                    "source": "mappingNotAlignedReason",
                                    "type": "textarea",
                                    "rows": 5

                                }
                            ]
                        }
                    ]
                },
                {
                    "width": "15%",
                    "type": "col",
                    "title": "Invoiced area (ha) of site/s agreements",
                    "helpText": "Enter the amount you will invoice for during this reporting period.",
                    "items": [
                        {
                            "source": "areaOfCoveredByAgreementsInvoicedHa",
                            "type": "number",
                            "displayOptions": {
                                "displayUnits": true
                            }
                        },

                        {
                            "type": "row",
                            "items": [
                                {
                                    "preLabel": "Reason for invoiced amount being different to actual amount",
                                    "source": "invoicedNotActualReason",
                                    "type": "selectOne"
                                }
                            ]
                        },
                        {
                            "type": "row",
                            "items": [
                                {
                                    "placeholder": "Please enter the reason/s the mapping didn't align with the invoiced amount",
                                    "source": "invoicedNotActualComments",
                                    "type": "textarea",
                                    "rows": 5

                                }
                            ]
                        }
                    ]
                }
            ],
            "userAddedRows": true,
            "source": "agreements",
            "type": "table"
        }]
    }]
}